rule CVE_2021_40444_document_xml_rels
{
    meta:
        description = "Detect Microsoft Office 0-day exploit CVE-2021-40444"
        author = "Antonio Blescia"
        date = "2021-09-09"
        // Based on @AlteredBytes work
    strings:
        $a_header = /^<\?xml\sversion=\"\d.\d\"/
        $b_relationship = /Type=\"http:\/\/schemas\.openxmlformats\.org\/officeDocument\/2006\/relationships\/oleObject\"/
        // Detect external OLE template
        $b_relshiptarget = /Target=\"mhtml\:https?\:.{,50}!x-usc\:https?:\/\/[^\"]+\"/ nocase
        $b_target = /TargetMode=\"External\"/
        
    condition:
        all of them
}
